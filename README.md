# parsegeonames
test task to tech company
### database info
file with cities you can take here - https://download.geonames.org/export/zip/

# Тестовое задание для infotecs

### ТЗ:

>Реализовать HTTP-сервер для предоставления информации по географическим объектам.
>Данные взять из географической базы данных GeoNames.

### Реализованный сервер должен предоставлять REST API со следующими методами:

 - Метод принимает идентификатор geonameid и возвращает информацию о городе.
 - Метод принимает страницу и количество отображаемых на странице городов и возвращает список городов с их информацией. 
 - Метод принимает названия двух городов (на русском языке) и получает информацию о найденных городах, а также дополнительно: какой из них расположен севернее и одинаковая ли у них временная зона (когда несколько городов имеют одно и то же название, разрешать неоднозначность выбирая город с большим населением; если население совпадает, брать первый попавшийся) .
 - Дополнительное задание: для 3-его метода показывать пользователю не только факт различия временных зон, но и на сколько они различаются.



### Реализация
Версия Python 3.8.1

Для реализации web интерфейса используется Flask 1.1.1.

Инструкцию по запуску скрипта можно найти в [документации фреймворка](https://flask.palletsprojects.com/en/1.1.x/quickstart/).

Интерфейс будет работать по адресу 127.0.0.1 и порту 5000.



База данных импортируется в кодировке 'utf-8', после чего загружается в список для дальнейшей обработки.

### Задание 1:

Метод доступен по адресу 

```web-idl
127.0.0.1:5000/cityInfo?geonameid=id
```

Данный метод принимает 1 параметр GET: 'geonameid', который должен содержать id города в базе данных geoname

Поиск искомого города происходит через бинарный поиск. Примерное время затраченное на поиск города:

```
5.2999999999858716e-05
```

После обнаружения города информация о нём переносится в словарь, который имеет структуры JSON-файла (В дальнейшем для отображения информации о городе будет использоваться эта структура):

```json
'geonameid': id,
'name': name,
'asciiname': asciiname, 
'alternatenames': alternatenames,
'latitude': latitude, 
'longtitude': longtitude,
'feature_class': feature_class, 
'feature_code': feature_code,
'county_code': country_code, 
'cc2': cc2,
'admin1_code': admin1_code, 
'admin2_code': admin2_code,
'admin3_code': admin3_code, 
'admin4_code': admin4_code,
'population': population, 
'elevation': elevation,
'dem': dem, 
'timezone': timezone,
'modification_date': modification_date
```



### Задание 2:

Метод доступен по адресу 

```web-idl
127.0.0.1:5000/citiesPage?number=num&cnt=count
```

Данный метод принимает 2 параметра GET: 'number', который должен содержать номер страницы, и 'cnt', который должен содержать количество городов на странице.

Для вывода списка городов, по заданным параметрам, сначала составляется список, удовлетворяющий данные параметры:

```python
cities_page_list = cities_list[((page_number - 1) * cities_page_count):(page_number * cities_page_count)]
```

После чего, с использованием цикла for, информация о каждом городе форматируется в JSON формат.



### Задание 3:

Метод доступен по адресу 

```web-idl
127.0.0.1:5000/compareCities?city_1=НазваниеГорода1&city_2=НазваниеГорода2
```

Данный метод принимает 2 параметра GET: 'city_1' и 'city_2', которые должны содержать названия двух городов (на русском языке).

Для поиска города по названию на русском языке необходимо разделить параметр, содержащий альтернативные название города, по знаку ",", после чего искать вхождение искомого названия в этом списке:

```python
find_result = [i for i, value in enumerate(cities_list) if city_name_1 in value[3].split(',')]
```

Критериями выбора города при совпадении названий являются:

* Город с наибольшим населением
* Если совпадает, то первый попавшийся

Для нахождения более северного города сравниваются показатели широты, город с большей широтой располагается севернее.

Для нахождения разницы во времени был составлен словарь, содержащий список всех временных зон России. После чего вычитается модуль разницы двух временных зон.

Дополнительная информация о городах содержится в отдельном словаре:

```json
"timezone_average": average,
"northern": city_name,
"timezone": bool
```

